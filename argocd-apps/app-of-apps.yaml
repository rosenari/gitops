# App of Apps 패턴을 구현하는 루트 ArgoCD 애플리케이션
# 이 애플리케이션은 다른 모든 ArgoCD 애플리케이션을 관리하는 상위 애플리케이션입니다.
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: app-of-apps                                    # 애플리케이션 이름
  namespace: argocd                                    # ArgoCD가 설치된 네임스페이스
  finalizers:
    - resources-finalizer.argocd.argoproj.io          # 애플리케이션 삭제 시 리소스 정리 보장
spec:
  project: default                                     # ArgoCD 프로젝트 (기본값 사용)
  source:
    repoURL: https://github.com/rosenari/gitops.git    # Git 저장소 URL
    targetRevision: HEAD                               # 추적할 브랜치/태그 (HEAD = 최신)
    path: argocd-apps                                  # 애플리케이션 정의가 있는 경로
  destination:
    server: https://kubernetes.default.svc             # 대상 클러스터 (현재 클러스터)
    namespace: argocd                                  # 대상 네임스페이스
  syncPolicy:
    automated:                                         # 자동 동기화 정책
      prune: true                                      # 삭제된 리소스 자동 정리
      selfHeal: true                                   # 드리프트 발생 시 자동 복구